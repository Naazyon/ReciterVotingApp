<!DOCTYPE html> {% extends "base.html" %} {% block content %}

<div class="py-2 mx-auto text-center">
    <h1 class="display-4">Chapter {{ chapter.id }} - {{ chapter.name }} ({{ chapter.translation }})</h1>
    <p class="lead">Vote Below!</p>
</div>

<table class="table table-striped table-bordered table-hover table-sm text-center ">
    <thead class="thead-dark">
        <tr>
            <th scope="col">Reciter</th>
            <th scope="col">Listen</th>
            <th scope="col">Vote</th>
        </tr>
    </thead>
    <tbody>
        {% for reciter in reciters %}
          <tr>
              <th scope="row" class="align-middle">{{ reciter.id }}</th>
              <td class="align-middle">
                  <audio controls class="full-width-audio">
                      <source class="d-block" src="/audio/{{ reciter.nick }}/{{ chapter.id }}.mp3" type="audio/mpeg"> Your browser does not support the audio element.
                  </audio>
              </td>
              <td class="align-middle">
              <button type="button" class="btn btn-info btn-block btn-sm" onclick = "vote({{ reciter.id }}, {{ chapter.id }}, {{ current_user.id }})" ><i class="fas fa-star"></i></button>
              </td>
          </tr>
        {% endfor %}
    </tbody>
</table>

<script type="text/javascript">
    function vote(reciter, chapterId, userId, upvote) {
      jQuery.ajax({
        type: "POST",
        url: window.location.pathname,
        data: {reciter: reciter, chapter: chapterId, user:userId, upvote:upvote}
      });
      alert("Vote submitted.");
      document.location.reload();
    };
    function submitReview(reciter) {
      jQuery.ajax({
        type: "POST",
        url: "/review",
        data: {reciter: reciter, chapter: {{chapter.id}}, user:{{current_user.id}}, content: $("#formReviewContent" + reciter).val(), rating: $("#formReviewRating" + reciter).val()}
      });
      alert("Review submitted.");
      document.location.reload();
    };
</script>

{% endblock %}